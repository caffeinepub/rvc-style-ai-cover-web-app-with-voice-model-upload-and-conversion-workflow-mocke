{
  "kind": "build_request",
  "title": "Add in-app configuration for Replicate API token",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Add an in-app UI that lets the user enter, save, and clear the Replicate API token used for voice conversion (instead of requiring only `VITE_REPLICATE_API_TOKEN` in `.env`).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Do you think you can make it so I can upload the API token through the app?"
        ]
      },
      "acceptanceCriteria": [
        "On the Create Cover flow, when no token is configured, the UI provides an input to paste a Replicate API token and a clear call-to-action to save it.",
        "The token input is masked by default with an option to reveal it.",
        "The UI provides a \"Clear token\" action that removes the stored token.",
        "User-facing text is in English and clearly indicates the token is stored on the client (browser) and not uploaded to the app backend."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Persist the Replicate API token on the client and update the voice conversion pipeline to use the stored token at runtime, with `import.meta.env.VITE_REPLICATE_API_TOKEN` as a fallback.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "upload the API token through the app"
        ]
      },
      "acceptanceCriteria": [
        "`isReplicateConfigured()` returns true when either a saved (runtime) token exists or `VITE_REPLICATE_API_TOKEN` is present.",
        "`convertVoiceWithReplicate(...)` uses the saved (runtime) token when available, otherwise falls back to `VITE_REPLICATE_API_TOKEN`.",
        "If neither token source exists (or the token is empty), voice conversion remains hard-blocked with a clear error message (no silent failures).",
        "The token is never sent to the Motoko backend in any API call or stored in backend state."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Add a token validation check in the token UI so the user can confirm whether the pasted token is valid before running a conversion.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "upload the API token through the app"
        ]
      },
      "acceptanceCriteria": [
        "The token UI includes a \"Test token\" action that makes a Replicate API request using the provided token and shows a success or error state.",
        "If validation fails, the UI shows a readable error and does not mark the token as valid/configured based solely on being non-empty.",
        "If validation succeeds, the Create Cover flow becomes enabled without requiring a page reload."
      ]
    }
  ],
  "constraints": [
    "Do not edit files under `frontend/src/components/ui`.",
    "Do not edit immutable hook files: `frontend/src/hooks/useInternetIdentity.ts`, `frontend/src/hooks/useInternetIdentity.tsx`, `frontend/src/hooks/useActor.ts`, `frontend/src/main.tsx`.",
    "Backend must remain a single Motoko actor in `backend/main.mo`; do not add external API calls to the backend (Replicate calls must remain client-side)."
  ],
  "nonGoals": [
    "Implementing third-party authentication for Replicate or any OAuth flow.",
    "Storing the Replicate token in the backend canister state.",
    "Adding additional external providers beyond Replicate."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}